# Bun configuration for opencode-swarm-plugin
# See: https://bun.sh/docs/runtime/bunfig

[test]
# Only scan src/ for tests - evals/ uses evalite runner, not bun test
root = "src"

# Default timeout for tests
timeout = 10000

# Preload script to restore mocks between test files
preload = ["./test-preload.ts"]

# IMPORTANT: Mock Pollution Issue
# ===============================
# Bun's mock.module() is GLOBAL and persists across test files in the same process.
# Tests that use mock.module() at module-level POLLUTE subsequent test files.
#
# EXCLUDED FILES (run separately with `bun test <file>`):
# These files use mock.module() which breaks other tests:
#   - src/compaction-hook.test.ts (mocks ./hive, swarm-mail, ./logger)
#   - src/compaction-observability.integration.test.ts (mocks same)
#   - src/eval-runner.test.ts (mocks evalite/runner)
#
# Run them individually: bun test ./src/compaction-hook.test.ts
#
# AFFECTED FILES (fail in full suite but pass individually):
#   - src/tool-adapter.integration.test.ts
#   - src/compaction-capture.integration.test.ts
#   - src/swarm.integration.test.ts
#
# Long-term fix: Refactor mock.module() tests to use dependency injection.
